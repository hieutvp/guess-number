# Guess Number Game—Spring Boot (Jakarta, JPA, JWT, PostgreSQL)

## 1. Giới thiệu
Dự án này là một ứng dụng backend Spring Boot cho trò chơi đoán số, cho phép:
- Đăng ký/đăng nhập người dùng (JWT Authentication).
- Quản lý điểm số, lượt chơi, xếp hạng.
- Hỗ trợ các API bảo mật cho thao tác với dữ liệu người chơi.
- Sử dụng PostgreSQL làm cơ sở dữ liệu chính.
- Cung cấp các API RESTful để tương tác với ứng dụng.

---

## 2. Yêu cầu môi trường

- **Java 17** trở lên
- **Maven 3.8+**
- **PostgreSQL 13+**
- **IDE**: IntelliJ IDEA, Eclipse hoặc bất kỳ IDE Java nào bạn thích.
- **Postman** hoặc **công cụ tương tự** để test API.
- **Maven**: Đảm bảo bạn đã cài đặt Maven và có thể chạy lệnh `mvn` từ terminal.
- **Git**: Để clone dự án từ kho lưu trữ.
---

## 3. Setup Cơ Sở Dữ Liệu

### Tạo cơ sở dữ liệu và user (PostgreSQL)
``` sql
CREATE DATABASE guess_number_db;
CREATE USER guessuser WITH PASSWORD 'guesspassword';
GRANT ALL PRIVILEGES ON DATABASE guess_number_db TO guessuser;
```
### Kết nối cơ sở dữ liệu từ `application.properties`:
``` properties
- spring.datasource.url=jdbc:postgresql://localhost:5432/guess_number_db
- spring.datasource.username=guessuser
- spring.datasource.password=guesspassword
- spring.jpa.hibernate.ddl-auto=update
- spring.jpa.show-sql=true
```

> *Mặc định ứng dụng sẽ tự tạo bảng với `spring.jpa.hibernate.ddl-auto=update`.*

### Câu lệnh tạo bảng `users` (nếu muốn tạo thủ công)
``` sql
create table if not exists users
(
    id bigint generated by default as identity
    constraint users_pkey
    primary key,
    email varchar(255),
    password varchar(255),
    role varchar(255),
    score integer not null,
    turns integer not null,
    username varchar(255) not null
    constraint ukr43af9ap4edm43mmtq01oddj6
    unique
);


alter table users
    owner to postgres;

create index if not exists idx_users_score_desc
    on users (score desc);

```
---

## 4. Build & Chạy Dự Án

### Tải dependency & build
bash mvn clean install


### Chạy ứng dụng
bash mvn spring-boot:run
Hoặc chạy file `GuessNumberApplication.java` từ IDE.

---

## 5. Hướng dẫn test nhanh API

### Đăng ký tài khoản

**POST** `/auth/register`
```json
 { "username": "user01", "password": "yourpassword", "email": "youremail@example.com" }
```
**Response:**
```json
{ "message": "User registered successfully" }
```
- **Lưu ý:** Tài khoản sẽ được tạo với điểm số và lượt chơi mặc định là 0.
- **Header:**
- Content-Type: application/json
- Authorization
- Bearer <jwt token>
### Đăng nhập lấy token

**POST** `/auth/login`
```json 
{ "username": "user01", "password": "yourpassword" }
```
**Response:**
```json
{ "token": "eyJhbGciOiJIUzI1NiJ9..." } // sử dụng token này cho các API bên dưới
```
- **Lưu ý:** Token sẽ hết hạn sau 1 giờ, cần đăng nhập lại để lấy token mới.
- **Header:**
- Content-Type: application/json
- Authorization
- Bearer <jwt token>
### Gọi API yêu cầu xác thực

Ví dụ: Lấy thông tin tài khoản

**GET** `/api/me`

**Header:**  
Authorization: Bearer
---

## 6. Sử dụng JWT Authentication

- Các API ngoài `/auth/**` đều yêu cầu header:
    ```
    Authorization: Bearer <jwt_token>
    ```
- Đăng nhập để lấy token, sau đó sử dụng token cho mọi request cần xác thực.

---

## 7. Một số API mẫu để test

- **Đăng ký:** `POST /auth/register`
- **Đăng nhập:** `POST /auth/login`
- **Lấy thông tin user:** `GET /api/me` (header phải có Bearer token)
- **Đoán số:** `POST /api/guess`
- **Mua thêm lượt chơi:** `POST /api/buy-turns` (mua thủ công)
- **Bảng xếp hạng:** `GET /api/leaderboard`
- **Các API khác:** Xem thêm trong source code controller.

---

## 8. Lưu ý

- Nhớ khởi động PostgreSQL và cập nhật lại cấu hình nếu cần.
- Lần đầu chạy ứng dụng có thể phải tạo sẵn cơ sở dữ liệu.
- Nên tham khảo thêm các API trong code, hoặc mở rộng thêm theo nhu cầu.

---